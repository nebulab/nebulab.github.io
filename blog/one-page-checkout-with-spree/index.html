<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">

    <title>One Page Checkout with Spree - Nebulab</title>
    <meta name="description" content="The purpose of this post is to show one way to implement one page checkout
with Spree. The goal here is to build a solution which is clean and elegant,
especially...">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@nebulab_it">

    <meta name="twitter:title" content="One Page Checkout with Spree - Nebulab">
    <meta name="twitter:description" content="The purpose of this post is to show one way to implement one page checkout
with Spree. The goal here is to build a solution which is clean and elegant,
especially...">
    <meta name="twitter:image" content="/blog/images/articles-images/one-page-checkout-with-spree/one_page_checkout_spree-5abc02e8.jpg">

        <meta property="twitter:creator" content="@AlbertoVena">
      <meta name="twitter:label1" content="Reading Time">
      <meta name="twitter:data1" content="16 minutes">

    <meta property="article:publisher" content="https://www.facebook.com/teamnebulab/">
    <meta property="og:title" content="One Page Checkout with Spree - Nebulab by Alberto Vena" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="http://nebulab.it/blog/one-page-checkout-with-spree/" />
    <meta property="og:image" content="/blog/images/articles-images/one-page-checkout-with-spree/one_page_checkout_spree-5abc02e8.jpg" />
    <meta property="og:description" content="The purpose of this post is to show one way to implement one page checkout
with Spree. The goal here is to build a solution which is clean and elegant,
especially..." />
    <meta property="og:site_name" content="Nebulab" />
    <meta property="fb:admins" content="244455778929654" />

    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "name": "Nebulab",
        "url": "http://nebulab.it",
        "logo": "http://nebulab.it/assets/images/public/logo.svg",
        "contactPoint": {
          "@type": "ContactPoint",
          "telephone": "+39-085-57296",
          "email": "hello@nebulab.it",
          "contactType": "sales",
          "availableLanguage": ["English", "Italian"]
        },
        "sameAs": [
          "https://www.facebook.com/teamnebulab",
          "https://www.instagram.com/teamnebulab",
          "https://twitter.com/nebulab_it",
          "https://www.linkedin.com/company/nebulab",
          "https://github.com/nebulab",
          "https://plus.google.com/108922619281149094352"
        ]
      }
    </script>

    <link href="/assets/images/favicon.ico" rel="icon" type="image/ico" />
    <link rel="apple-touch-icon" href="/assets/images/apple-touch-icon-0eb6fabe.png" />
    <script>
  (function(d) {
    var config = {
      kitId: 'zgl1gmr',
      scriptTimeout: 3000,
      async: false
    },
    h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
  })(document);
</script>

    <!-- Hotjar Tracking Code for http://nebulab.it/ -->
<script>
  (function(h,o,t,j,a,r){
    h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
    h._hjSettings={hjid:434151,hjsv:5};
    a=o.getElementsByTagName('head')[0];
    r=o.createElement('script');r.async=1;
    r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
    a.appendChild(r);
  })(window,document,'//static.hotjar.com/c/hotjar-','.js?sv=');
</script>

    <link href="/assets/stylesheets/application-b7024cb7.css" rel="stylesheet" />
  </head>

  <body class="blog blog_one-page-checkout-with-spree blog_one-page-checkout-with-spree_index">
    <div class="menu-button">
  <span class="menu-button__line"></span>
  <span class="menu-button__line"></span>
  <span class="menu-button__line"></span>
</div>

<div class="full-menu is-closed">
  <div class="full-menu__content">

  <div class="full-menu__content__logo">
<a href="../../">      <img src="/assets/images/logo_white-1233a304.svg" width="148px" height="45px" alt="Logo white" />
</a>  </div>

  <nav class="full-menu__content__navigation">
    <ul class="full-menu__content__navigation__list">
      <li class="full-menu__content__navigation__list__item">
        <a href="../../" class="full-menu__content__navigation__list__item__link">Home</a>
      </li>
      <li class="full-menu__content__navigation__list__item">
        <a href="/services" class="full-menu__content__navigation__list__item__link">Services</a>
      </li>
      <li class="full-menu__content__navigation__list__item">
        <a href="/about-us" class="full-menu__content__navigation__list__item__link">About us</a>
      </li>
      <li class="full-menu__content__navigation__list__item">
        <a href="/lab" class="full-menu__content__navigation__list__item__link">Lab</a>
      </li>
      <li class="full-menu__content__navigation__list__item">
        <a href="/contact-us" class="full-menu__content__navigation__list__item__link">Contact us</a>
      </li>
      <li class="full-menu__content__navigation__list__item">
        <a href="/blog" class="full-menu__content__navigation__list__item__link">Blog</a>
      </li>
    </ul>
  </nav>

  <div class="full-menu__content__contact">
    <ul class="full-menu__content__contact__list">
      <li class="full-menu__content__contact__list__item">
        <h6>
          Let's talk
        </h6>
      </li>
      <li class="full-menu__content__contact__list__item">
        <a href="mailto:hello@nebulab.it" class="full-menu__content__contact__list__item__link">hello@nebulab.it</a>
      </li>
      <li class="full-menu__content__contact__list__item">
        <a href="tel:+3908557296" class="full-menu__content__contact__list__item__link">(+39) 085 57296</a>
      </li>
    </ul>
    <ul class="full-menu__content__contact__list">
      <li class="full-menu__content__contact__list__item">
        <h6>
          Follow us
        </h6>
      </li>
      <ul class="social-icons">
  <li class="social-icons__item">
    <a href="http://twitter.com/nebulab_it" target="_blank" class="social-icons__item__link"><i class="fa fa-twitter"></i></a>
  </li>
  <li class="social-icons__item">
    <a href="https://www.facebook.com/teamnebulab" target="_blank" class="social-icons__item__link"><i class="fa fa-facebook"></i></a>
  </li>
  <li class="social-icons__item">
    <a href="https://instagram.com/teamnebulab/" target="_blank" class="social-icons__item__link"><i class="fa fa-instagram"></i></a>
  </li>
  <li class="social-icons__item">
    <a href="http://github.com/nebulab" target="_blank" class="social-icons__item__link"><i class="fa fa-github"></i></a>
  </li>
</ul>

    </ul>
  </div>

</div>

</div>

<header class="header">
<a href="../../">      <img src="/assets/images/logo-468b9b26.svg" width="148px" height="45px" class="logo" alt="Logo" />
</a>
  <nav class="main-navigation">
  <ul class="main-navigation__list">
    <li class="main-navigation__list__item">
      <a href="/services" class="main-navigation__list__item__link ">Services</a>
    </li>
    <li class="main-navigation__list__item">
      <a href="/about-us" class="main-navigation__list__item__link ">About us</a>
    </li>
    <li class="main-navigation__list__item">
      <a href="/lab" class="main-navigation__list__item__link ">Lab</a>
    </li>
    <li class="main-navigation__list__item">
      <a href="/contact-us" class="main-navigation__list__item__link ">Contact us</a>
    </li>
    <li class="main-navigation__list__item">
      <a href="/blog" class="main-navigation__list__item__link active">Blog</a>
    </li>
  </ul>
</nav>


</header>


      <section class="blog-page">
    <article class="blog-post">
      <header class="blog-post__header">
        <h1 class="blog-post__header__title">
          One Page Checkout with Spree
        </h1>

        <span class="blog-post__header__author">
            <span class="blog-post__header__author__img">
              <img src="/blog/images/authors/alberto-f63de619.jpg" alt="Alberto" />
            </span>

          <span class="blog-post__header__author__name">
            Alberto Vena
          </span>
        </span>

        <span class="blog-post__header__tags">
          #Code
        </span>

        <h6 class="blog-post__header__reading-time">
          16 minutes Read
        </h6>
      </header>

        <div class="blog-post__cover">
    <img src="/blog/images/articles-images/one-page-checkout-with-spree/one_page_checkout_spree-5abc02e8.jpg" alt="One Page Checkout with Spree" />
  </div>


      <div class="blog-post__body">
        <p>The purpose of this post is to show <strong>one way</strong> to implement one page checkout
with Spree. The goal here is to build a solution which is clean and elegant,
especially taking into account the ability of the app to be easily updated
when a new version of Spree comes out.</p>

<h2>How Spree Checkout works</h2>

<p>It’s basically a state machine which runs validations and callbacks when trying
to go from a step into the next one. It&rsquo;s really flexible thanks to its own
<a href="http://guides.spreecommerce.com/developer/checkout.html#the-checkout-flow-dsl">DSL</a>,
built to allow checkout flow customization. Default steps are <strong>address</strong>,
<strong>delivery</strong>, <strong>payment</strong> and <strong>confirm</strong> (optional, depending on the payment
method used or if the
<a href="https://github.com/spree/spree/blob/master/core/app/models/spree/app_configuration.rb#L35">related preference</a>
is set).</p>

<h2>The strategy</h2>

<p>What we are going to do is to just display <strong>all steps into a single page</strong>
changing the steps submit buttons so that they are going to make <strong>anynchronous
requests</strong> each time we hit continue on the current step. This ajax <code>update</code>
request will be automatically handled by <code>Spree::CheckoutController</code>.
Creating a <strong>js view</strong> for this action we can easily update the right step:
in case of successful responses the next step will be updated otherwise
the current step will be updated and validation errors will be displayed.</p>

<p>Also, we are going to implement some UX improvement since it will be
better to <strong>disable inactive steps</strong> hiding outdated summary and preventing
form elements from being used.</p>

<h3>Confirm step is required</h3>

<p>We need the last step to skip the ajax request. This is needed because in
case of success it will redirect us to the <code>completion_route</code> which uses a
separate controller and view (usually <code>Spree::OrdersController.show</code>).</p>

<h2>All steps in one page</h2>

<p>Our first goal will be to show all the steps in a single page. We can easily
do it by overloading the <code>checkout/edit.html.erb</code> view of our application:</p>
<pre class="highlight erb"><code><span class="c">&lt;!-- app/views/spree/checkout/edit.html.erb --&gt;</span>

<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"checkout"</span> <span class="na">data-hook</span><span class="nt">&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@order</span><span class="p">.</span><span class="nf">checkout_steps</span><span class="p">[</span><span class="mi">0</span><span class="p">.</span><span class="nf">.</span><span class="p">.</span><span class="nf">-</span><span class="mi">1</span><span class="p">].</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">state</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row checkout_content </span><span class="cp">&lt;%=</span> <span class="s1">'disabled-step'</span> <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="vi">@order</span><span class="p">.</span><span class="nf">state</span> <span class="cp">%&gt;</span><span class="s">"</span> <span class="na">data-step=</span><span class="s">"</span><span class="cp">&lt;%=</span> <span class="n">state</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="na">data-hook=</span><span class="s">"checkout_content"</span> <span class="na">id=</span><span class="s">"checkout_</span><span class="cp">&lt;%=</span> <span class="n">state</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">:partial</span> <span class="o">=&gt;</span> <span class="s1">'form_wrapper'</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:order</span> <span class="o">=&gt;</span> <span class="vi">@order</span><span class="p">,</span> <span class="ss">:state</span> <span class="o">=&gt;</span> <span class="n">state</span> <span class="p">}</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>

# ...

</code></pre>
<p>On a side note, this is the <strong>only view we are overloading</strong> to have this
approach working. To disable one step checkout we can just remove (or rename)
this file and the default behavior will be restored.</p>

<p>We are basically cycling on every checkout step. For each step we render
a new <code>_form_wrapper</code> partial wich will be responsible to display the step
correctly. Here is the code of this new partial:</p>
<pre class="highlight erb"><code><span class="c">&lt;!-- app/views/spree/checkout/_form_wrapper.html.erb --&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"columns </span><span class="cp">&lt;%=</span> <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="s1">'confirm'</span> <span class="k">then</span> <span class="s1">'alpha twelve'</span> <span class="k">else</span> <span class="s1">'alpha omega sixteen'</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="s">"</span> <span class="na">data-hook=</span><span class="s">"checkout_form_wrapper"</span><span class="nt">&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">:partial</span> <span class="o">=&gt;</span> <span class="s1">'spree/shared/error_messages'</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:target</span> <span class="o">=&gt;</span> <span class="n">order</span> <span class="p">}</span> <span class="cp">%&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">form_for</span> <span class="n">order</span><span class="p">,</span> <span class="ss">:url</span> <span class="o">=&gt;</span> <span class="n">update_checkout_path</span><span class="p">(</span><span class="n">state</span><span class="p">),</span> <span class="ss">:remote</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">state</span> <span class="o">!=</span> <span class="s1">'confirm'</span><span class="p">),</span> <span class="ss">:html</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:id</span> <span class="o">=&gt;</span> <span class="s2">"checkout_form_</span><span class="si">#{</span><span class="n">state</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">unless</span> <span class="n">order</span><span class="p">.</span><span class="nf">email?</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"field"</span> <span class="na">style=</span><span class="s">'clear: both'</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:email</span> <span class="cp">%&gt;</span><span class="nt">&lt;br</span> <span class="nt">/&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:email</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/p&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="n">state</span><span class="p">,</span> <span class="ss">:form</span> <span class="o">=&gt;</span> <span class="n">form</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="s1">'confirm'</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"checkout-summary"</span> <span class="na">data-hook=</span><span class="s">"checkout_summary_box"</span> <span class="na">class=</span><span class="s">"columns omega four"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">:partial</span> <span class="o">=&gt;</span> <span class="s1">'summary'</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:order</span> <span class="o">=&gt;</span> <span class="n">order</span> <span class="p">}</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<p>The code is quite similar to the original <code>edit.html.erb</code> Spree view. We added</p>
<pre class="highlight ruby"><code><span class="ss">:remote</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">state</span> <span class="o">!=</span> <span class="s1">'confirm'</span><span class="p">),</span>
</code></pre>
<p>to the <code>form_for</code> tag in order to make ajax requests unless the current state
is the <code>confirm</code> one.</p>

<p>At this point we’ll have all our steps into a single page:</p>

<p><img src="/blog/images/articles-images/one-page-checkout-with-spree/steps-d52f49de.png" alt="All steps in a singe page" /></p>

<p>As you can see, since we still don&rsquo;t know what the user&rsquo;s address is, the
<strong>delivery step is empty</strong>; it will be filled with the shipping method once
we know what shipping method is available for a user within a certain zone.</p>

<h2>Advance through the steps with Ajax</h2>

<p>So, what happens when we hit &ldquo;Save and Continue&rdquo;? An asynchronous request is
made and the <code>Spree::CheckoutController#update</code> method is called.
Rails responds with a js file since that&rsquo;s exactly the default way
Spree responds to a <code>remote</code> request. We just need to create a js file (we&rsquo;ll
go with coffeescript) which will be executed at each <code>update</code> response:</p>
<pre class="highlight coffeescript"><code><span class="c1"># app/views/spree/checkout/edit.js.coffee</span>

<span class="nx">partial</span> <span class="o">=</span> <span class="s">"&lt;%=j render :partial =&gt; 'form_wrapper', :format =&gt; :html, :locals =&gt; { :state =&gt; @order.state, :order =&gt; @order } %&gt;"</span>
<span class="nx">step</span> <span class="o">=</span> <span class="p">(</span><span class="nx">$</span> <span class="s">'#checkout_&lt;%= @order.state %&gt;'</span><span class="p">)</span>
<span class="nx">error</span> <span class="o">=</span> <span class="s">"&lt;%= flash[:error] %&gt;"</span>

<span class="nx">replace_checkout_step</span><span class="p">(</span><span class="nx">step</span><span class="p">,</span> <span class="nx">partial</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span>
</code></pre>
<ul>
<li><code>partial</code> variable will contain the html of the step we need to render
(the next one unless there
are errors that prevent to go to the next step);</li>
<li><code>step</code> variable will contain the element we are going to update;</li>
<li><code>error</code> variable will contain potential errors we want to render;</li>
<li><code>replace_checkout_step</code> method is defined in the assets directory into a
proper one-page-checkout support file which will also contain other
convenience methods:</li>
</ul>
<pre class="highlight coffeescript"><code><span class="c1"># app/assets/javascripts/spree/frontend/one_page_checkout.js.coffee</span>

<span class="nb">window</span><span class="p">.</span><span class="na">replace_checkout_step</span> <span class="o">=</span> <span class="p">(</span><span class="nx">step</span><span class="p">,</span> <span class="nx">partial</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">disable_steps</span> <span class="no">true</span>
  <span class="nx">step</span><span class="p">.</span><span class="na">html</span><span class="p">(</span><span class="nx">partial</span><span class="p">)</span> <span class="k">if</span> <span class="nx">partial</span><span class="o">?</span>
  <span class="nx">step</span><span class="p">.</span><span class="na">find</span><span class="p">(</span><span class="s">'form.edit_order'</span><span class="p">).</span><span class="na">prepend</span><span class="p">(</span><span class="s">"&lt;p class='checkout-error'&gt;</span><span class="si">#{</span><span class="nx">error</span><span class="si">}</span><span class="s">&lt;/p&gt;"</span><span class="p">)</span> <span class="k">if</span> <span class="o">!!</span><span class="nx">error</span>
  <span class="nx">enable_step</span> <span class="nx">step</span>

<span class="nx">enable_step</span> <span class="o">=</span> <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">element</span><span class="p">.</span><span class="na">removeClass</span><span class="p">(</span><span class="s">"disabled-step"</span><span class="p">)</span>
  <span class="nx">element</span><span class="p">.</span><span class="na">find</span><span class="p">(</span><span class="s">"form input"</span><span class="p">).</span><span class="na">removeAttr</span><span class="p">(</span><span class="s">"disabled"</span><span class="p">)</span>
  <span class="nx">element</span><span class="p">.</span><span class="na">find</span><span class="p">(</span><span class="s">"#checkout-summary, .errorExplanation"</span><span class="p">).</span><span class="na">show</span><span class="p">()</span>
  <span class="c1"># Call Spree step specific javascript</span>
  <span class="nx">Spree</span><span class="p">.</span><span class="na">onAddress</span><span class="p">()</span> <span class="k">if</span> <span class="nx">element</span><span class="p">.</span><span class="na">data</span><span class="p">(</span><span class="s">'step'</span><span class="p">)</span> <span class="o">==</span> <span class="s">'address'</span>
  <span class="nx">Spree</span><span class="p">.</span><span class="na">onPayment</span><span class="p">()</span> <span class="k">if</span> <span class="nx">element</span><span class="p">.</span><span class="na">data</span><span class="p">(</span><span class="s">'step'</span><span class="p">)</span> <span class="o">==</span> <span class="s">'payment'</span>

<span class="nx">disable_steps</span> <span class="o">=</span> <span class="p">(</span><span class="nx">all</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">elements</span> <span class="o">=</span> <span class="k">if</span> <span class="nx">all</span><span class="o">?</span> <span class="k">then</span> <span class="p">(</span><span class="nx">$</span> <span class="s">".checkout_content"</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="nx">$</span> <span class="s">".checkout_content.disabled-step"</span><span class="p">)</span>
  <span class="nx">elements</span><span class="p">.</span><span class="na">addClass</span><span class="p">(</span><span class="s">"disabled-step"</span><span class="p">)</span>
  <span class="nx">elements</span><span class="p">.</span><span class="na">find</span><span class="p">(</span><span class="s">"form input"</span><span class="p">).</span><span class="na">attr</span><span class="p">(</span><span class="s">"disabled"</span><span class="p">,</span> <span class="s">"disabled"</span><span class="p">)</span>
  <span class="nx">elements</span><span class="p">.</span><span class="na">find</span><span class="p">(</span><span class="s">"#checkout-summary, .errorExplanation"</span><span class="p">).</span><span class="na">hide</span><span class="p">()</span>

<span class="nx">Spree</span><span class="p">.</span><span class="na">ready</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">$</span> <span class="s">'#checkout'</span><span class="p">).</span><span class="na">is</span><span class="p">(</span><span class="s">'*'</span><span class="p">)</span>
    <span class="nx">disable_steps</span><span class="p">()</span>
</code></pre>
<p>The code is quite self-explanatory; anyway, this is what happens everytime
<code>replace_checkout_step</code> is called:</p>

<ul>
<li>all steps are disabled (a <code>.disabled-step</code> class is added to all steps,
form elements are disabled, summary and errors are hidden);</li>
<li>the html code of the right step is updated;</li>
<li>eventual flash messages are prepended to the current step&rsquo;s div;</li>
<li>form elements are enabled and summary is shown only into the current step;</li>
<li><code>.disabled-step</code> class is removed from the current step;</li>
<li>if the current step is address or payment step, default Spree js is called
in order to attach default Spree handlers to the just created DOM elements.</li>
</ul>

<p>Just as a UI improvement we can set an opacity layer via CSS to all disabled
steps:</p>
<pre class="highlight css"><code><span class="c">/* app/assets/stylesheets/spree/frontend/one_page_checkout.css.scss */</span>

<span class="nc">.disabled-step</span> <span class="p">{</span>
  <span class="nl">opacity</span><span class="p">:</span> <span class="m">.5</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>This is the result:</p>

<p><img src="/blog/images/articles-images/one-page-checkout-with-spree/one-page-checkout-6386197d.gif" alt="Steps with opacity" /></p>

<h2>Further Developments</h2>

<p>As said at the beginning of the post, this is just a basic solution you could
extend to add more features and custom style; for example you could just show
the step title if it&rsquo;s a disabled step. Other useful features are
<strong>enabling popstate</strong> to let URLs update reflecting the current step and
<strong>automatic and animated scroll</strong> while a new step is reached.</p>

<p>If you want to give it a try, here is the <a href="https://github.com/nebulab/spree-one-page-checkout">source code</a>
of what has been done here.</p>

      </div>

      <div class="blog-post__share">
  <h6 class="blog-post__share__title">
    Share
  </h6>

  <ul class="share-links-list js-social-links">
  <li>
    <a href="http://twitter.com/intent/tweet?status=One Page Checkout with Spree+http://nebulab.it/blog/one-page-checkout-with-spree/ via @nebulab_it">
      <i class='fa fa-twitter'></i>
    </a>
  </li>
  <li>
    <a href="http://www.facebook.com/share.php?u=http://nebulab.it/blog/one-page-checkout-with-spree/&title=One Page Checkout with Spree">
      <i class='fa fa-facebook'></i>
    </a>
  </li>
  <li>
    <a href="http://www.linkedin.com/shareArticle?mini=true&url=http://nebulab.it/blog/one-page-checkout-with-spree/&title=One Page Checkout with Spree&source=http://nebulab.it">
      <i class='fa fa-linkedin'></i>
    </a>
  </li>
</ul>

</div>

    </article>
  </section>

  



  <div class="blog-post">
    <div class="blog-post__comments">
  <h2>Join the Conversation</h2>

  <div id="disqus_thread"></div>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

  </div>


    <footer class="footer">
  <div class="footer__content">
    <ul class="footer__content__list">
      <li class="footer__content__list__item">
        <h6>
          Nebulab srls
        </h6>
      </li>
      <li class="footer__content__list__item">
        <a href="mailto:hello@nebulab.it" class="footer__content__list__item__link mail">hello@nebulab.it</a>
      </li>
      <li class="footer__content__list__item">
        <a href="tel:+3908557296" class="footer__content__list__item__link phone">(+39) 085 57296</a>
      </li>
      <li class="footer__content__list__item">
        VAT Number: IT02112180688
      </li>
      <li class="footer__content__list__item">
        <a href="/contact-us#careers" class="footer__content__list__item__link careers-link">Careers</a>
      </li>
      <li class="footer__content__list__item">
        <ul class="social-icons">
  <li class="social-icons__item">
    <a href="http://twitter.com/nebulab_it" target="_blank" class="social-icons__item__link"><i class="fa fa-twitter"></i></a>
  </li>
  <li class="social-icons__item">
    <a href="https://www.facebook.com/teamnebulab" target="_blank" class="social-icons__item__link"><i class="fa fa-facebook"></i></a>
  </li>
  <li class="social-icons__item">
    <a href="https://instagram.com/teamnebulab/" target="_blank" class="social-icons__item__link"><i class="fa fa-instagram"></i></a>
  </li>
  <li class="social-icons__item">
    <a href="http://github.com/nebulab" target="_blank" class="social-icons__item__link"><i class="fa fa-github"></i></a>
  </li>
</ul>

      </li>
    </ul>
    <ul class="footer__content__list">
      <li class="footer__content__list__item">
        <h6>
          Pescara
        </h6>
      </li>
      <li class="footer__content__list__item">
        <a href="https://goo.gl/maps/RGmbCp19mMD2" target="_blank" class="footer__content__list__item__link">Strada Comunale Piana, 1/1 <br> 65129 Pescara <br> Italy</a>
      </li>
    </ul>
    <ul class="footer__content__list">
      <li class="footer__content__list__item">
        <h6>
          Latina
        </h6>
      </li>
      <li class="footer__content__list__item">
        <a href="https://goo.gl/T4pIR1" target="_blank" class="footer__content__list__item__link">Via Ufente, 20 <br> 04100 Latina <br> Italy</a>
      </li>
    </ul>
    <ul class="footer__content__list">
      <li class="footer__content__list__item">
        <h6>
          Start a project
        </h6>
      </li class="footer__content__list__item">
        <h2>
          <a href="/contact-us" class="footer__content__list__item__link">Let's talk</a>
        </h2>
      </li>
    </ul>
  </div>
</footer>


    <div class="cookie-message">
      <p>This site uses cookies. Continuing you accept <a href="/privacy-policy">our terms</a>. &nbsp <a class='close-button'>Close</a></p>
    </div>

    <script src="/assets/javascripts/application-fd819535.js"></script>
      <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(["_setAccount", "UA-25604808-1"]);
  _gaq.push(["_trackPageview"]);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
  </body>
</html>
